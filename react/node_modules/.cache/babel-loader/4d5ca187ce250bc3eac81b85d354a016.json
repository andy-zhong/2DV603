{"ast":null,"code":"var _jsxFileName = \"/Users/GAMEHERO/Desktop/2DV603/\\u6700\\u540E\\u7684\\u4F5C\\u4E1A/2DV603-master/react/src/utils.js\";\nimport Config from \"./config\";\nimport Cookie from './cookie';\nimport ReactDOM from \"react-dom\";\nimport Alert from \"./Public/Alert\";\nimport React from \"react\";\nvar utils = {};\n\nutils.url = function (url) {\n  url = \"/\" + url.replace(/-/g, \"/\");\n  url += \".do\";\n  return url;\n};\n\nutils.requestUrl = function (url) {\n  url = url.replace(\"-\", \"/\");\n  return url;\n};\n\nutils.jsonToForm = function (json) {\n  var form = \"\";\n\n  for (var j in json) {\n    form += j + \"=\" + json[j] + \"&\";\n  }\n\n  if (form.length > 0) form = form.substring(0, form.length - 1);\n  return form;\n};\n\nutils.request = function (url, body, success, fail) {\n  var $this = this;\n  $this.showLoading();\n  fetch(url, {\n    method: \"POST\",\n    mode: \"cors\",\n    body: body,\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\n    }\n  }).then(function (res) {\n    return res.text();\n  }).then(function (data) {\n    $this.hideLoading();\n    data = data ? JSON.parse(data) : null;\n\n    if (data) {\n      if (data.code === -1) {\n        $this.alert(data.message, function () {\n          window.location.href = $this.url('member-login');\n        });\n        return false;\n      }\n\n      if (data.code === 1 && success) success(data.message);\n      if (data.code === 0 && fail) fail(data.message);\n    }\n  });\n};\n\nutils.upload = function (url, body, success, fail) {\n  var $this = this;\n  $this.showLoading();\n  fetch(url, {\n    method: \"POST\",\n    mode: \"cors\",\n    body: body,\n    headers: {}\n  }).then(function (res) {\n    return res.text();\n  }).then(function (data) {\n    $this.hideLoading();\n    data = data ? JSON.parse(data) : null;\n\n    if (data) {\n      if (data.code === 1 && success) success(data.message);\n      if (data.code === 0 && fail) fail(data.message);\n    }\n  });\n};\n\nutils.checkMember = function (callback) {\n  var c = this.getLoginCookie();\n  this.request(Config.requestUrl + this.requestUrl('member-read'), \"cookie=\" + encodeURIComponent(c), function (data) {\n    if (callback) callback(data);\n  });\n};\n\nutils.getLoginCookie = function () {\n  return Cookie.load(\"loginCookie\");\n};\n\nutils.alert = function (message, callback, time) {\n  var div = document.createElement('div');\n\n  if (typeof callback === 'function') {\n    if (time > 0) {\n      ReactDOM.render(React.createElement(Alert, {\n        message: message,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }), div);\n      setTimeout(callback, time);\n    }\n\n    if (!time) {\n      ReactDOM.render(React.createElement(Alert, {\n        message: message,\n        callback: callback,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      }), div);\n    }\n  } else {\n    ReactDOM.render(React.createElement(Alert, {\n      message: message,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }), div);\n  }\n\n  document.body.appendChild(div);\n};\n\nutils.timeToDate = function (time) {\n  if (isNaN(time - 1)) return null;\n  var date = new Date(time * 1000);\n  return date.getFullYear() + '-' + this.addZero(date.getMonth() + 1, 2) + '-' + this.addZero(date.getDay(), 2) + ' ' + this.addZero(date.getHours(), 2) + ':' + this.addZero(date.getMinutes(), 2) + ':' + this.addZero(date.getSeconds(), 2);\n};\n\nutils.addZero = function (number, count) {\n  while ((number + '').length < count) {\n    number = '0' + number;\n  }\n\n  return number;\n}; // Loading animation\n\n\nutils.showLoading = function () {\n  window.loading = true;\n};\n\nutils.hideLoading = function () {\n  window.loading = false;\n};\n\nexport default utils;","map":{"version":3,"sources":["/Users/GAMEHERO/Desktop/2DV603/最后的作业/2DV603-master/react/src/utils.js"],"names":["Config","Cookie","ReactDOM","Alert","React","utils","url","replace","requestUrl","jsonToForm","json","form","j","length","substring","request","body","success","fail","$this","showLoading","fetch","method","mode","headers","then","res","text","data","hideLoading","JSON","parse","code","alert","message","window","location","href","upload","checkMember","callback","c","getLoginCookie","encodeURIComponent","load","time","div","document","createElement","render","setTimeout","appendChild","timeToDate","isNaN","date","Date","getFullYear","addZero","getMonth","getDay","getHours","getMinutes","getSeconds","number","count","loading"],"mappings":"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","sourcesContent":["import Config from \"./config\";\r\nimport Cookie from './cookie';\r\n\r\nimport ReactDOM from \"react-dom\";\r\nimport Alert from \"./Public/Alert\";\r\nimport React from \"react\";\r\n\r\nlet utils = {};\r\n\r\nutils.url = function(url){\r\n    url = \"/\"+url.replace(/-/g, \"/\");\r\n    url += \".do\";\r\n    return url;\r\n}\r\n\r\nutils.requestUrl = function(url){\r\n    url = url.replace(\"-\", \"/\");\r\n    return url;\r\n}\r\n\r\nutils.jsonToForm = function(json){\r\n    let form = \"\";\r\n    for(let j in json){\r\n        form += j+\"=\"+json[j]+\"&\"\r\n    }\r\n    if(form.length>0) form = form.substring(0, form.length-1);\r\n    return form;\r\n}\r\n\r\nutils.request = function(url, body, success, fail){\r\n    let $this = this;\r\n    $this.showLoading();\r\n    fetch(url, {\r\n        method: \"POST\",\r\n        mode: \"cors\",\r\n        body: body,\r\n        headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'\r\n        },\r\n    }).then(res=>res.text()).then(data=>{\r\n        $this.hideLoading();\r\n        data = data ? JSON.parse(data) : null;\r\n        if(data) {\r\n            if(data.code===-1){\r\n                $this.alert(data.message, function(){\r\n                    window.location.href = $this.url('member-login');\r\n                })\r\n                return false;\r\n            }\r\n            if(data.code===1 && success) success(data.message);\r\n            if(data.code===0 && fail) fail(data.message);\r\n        }\r\n    });\r\n}\r\n\r\nutils.upload = function(url, body, success, fail){\r\n    let $this = this;\r\n    $this.showLoading();\r\n    fetch(url, {\r\n        method: \"POST\",\r\n        mode: \"cors\",\r\n        body: body,\r\n        headers: {\r\n\r\n        },\r\n    }).then(res=>res.text()).then(data=>{\r\n        $this.hideLoading();\r\n        data = data ? JSON.parse(data) : null;\r\n        if(data) {\r\n            if(data.code===1 && success) success(data.message);\r\n            if(data.code===0 && fail) fail(data.message);\r\n        }\r\n    });\r\n}\r\n\r\nutils.checkMember = function(callback){\r\n    let c = this.getLoginCookie();\r\n    this.request(Config.requestUrl+this.requestUrl('member-read'), \"cookie=\" + encodeURIComponent(c), function(data){\r\n        if(callback) callback(data);\r\n    });\r\n}\r\n\r\nutils.getLoginCookie = function(){\r\n    return Cookie.load(\"loginCookie\");\r\n}\r\n\r\nutils.alert = function(message, callback, time){\r\n    let div = document.createElement('div');\r\n    if(typeof callback==='function'){\r\n        if(time>0) {\r\n            ReactDOM.render(<Alert message={message} />, div);\r\n            setTimeout(callback, time);\r\n        }\r\n        if(!time) {\r\n            ReactDOM.render(<Alert message={message} callback={callback} />, div)\r\n        }\r\n    }else{\r\n        ReactDOM.render(<Alert message={message} />, div);\r\n    }\r\n    document.body.appendChild(div);\r\n}\r\n\r\nutils.timeToDate = function(time){\r\n    if(isNaN(time-1)) return null;\r\n    let date = new Date(time*1000);\r\n    return date.getFullYear() + '-' + this.addZero(date.getMonth()+1,2) + '-' + this.addZero(date.getDay(),2) + ' ' + this.addZero(date.getHours(),2) + ':' + this.addZero(date.getMinutes(),2) + ':' + this.addZero(date.getSeconds(),2);\r\n}\r\nutils.addZero = function(number, count){\r\n    while((number+'').length<count){\r\n        number = '0' + number;\r\n    }\r\n    return number;\r\n}\r\n\r\n// Loading animation\r\nutils.showLoading = function(){\r\n    window.loading = true;\r\n}\r\nutils.hideLoading = function(){\r\n    window.loading = false;\r\n}\r\n\r\nexport default utils;\r\n"]},"metadata":{},"sourceType":"module"}